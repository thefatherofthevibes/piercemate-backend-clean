import{T as le,D as ce}from"./chunk-WG7UTTKY-BPkZ2IK1.js";import{D as ue}from"./chunk-VT2JJ5C2-C9WnHsyg.js";import{g as de,a as fe}from"./chunk-NTEWUH4C-Zwbwn2Hl.js";import{M as ge}from"./chunk-INE2QCSC-9vPt_CRj.js";import{P as me,S as _e,C as he,V as ye}from"./chunk-XLDQPLK4-D0NBFajW.js";import{P as pe}from"./chunk-IQBAUTU5-DpWPUSGG.js";import{D as be,S as Ce,u as Se,a as ve}from"./chunk-KCWP7RF5-BTLBwV1W.js";import{u as xe}from"./chunk-C76H5USB-B0JL6HGS.js";import{b as Y,r as p,j as u,B as Z,C as je,d as Ae,au as De,bx as Oe,h as Ne,by as k,bz as Ee,aa as Re,ai as H,an as K,bA as Te,ak as we}from"./index-CU6eNUFN.js";import{R as Fe}from"./react-country-flag.esm-BUxefnxS.js";var ke=({isDefaultView:e,currentViewId:t,currentViewName:r,onSaveAsDefault:n,onUpdateExisting:i,onSaveAsNew:s})=>{const{t:a}=Y(),d=Ne(),l=async()=>{await d({title:a("views.prompts.updateDefault.title"),description:a("views.prompts.updateDefault.description"),confirmText:a("views.prompts.updateDefault.confirmText"),cancelText:a("views.prompts.updateDefault.cancelText")})&&n()},x=async()=>{await d({title:a("views.prompts.updateView.title"),description:a("views.prompts.updateView.description",{name:r}),confirmText:a("views.prompts.updateView.confirmText"),cancelText:a("views.prompts.updateView.cancelText")})&&i()};return u.jsxs(k,{children:[u.jsx(k.Trigger,{asChild:!0,children:u.jsxs(Z,{variant:"secondary",size:"small",type:"button",children:[a("views.save"),u.jsx(Ee,{})]})}),u.jsx(k.Content,{align:"end",children:e?u.jsxs(u.Fragment,{children:[u.jsx(k.Item,{onClick:l,children:a("views.updateDefaultForEveryone")}),u.jsx(k.Item,{onClick:s,children:a("views.saveAsNew")})]}):u.jsxs(u.Fragment,{children:[u.jsx(k.Item,{onClick:x,children:a("views.updateViewName")}),u.jsx(k.Item,{onClick:s,children:a("views.saveAsNew")})]})})]})};function $e(e,t){const[r,n]=p.useState(()=>{if(e!=null&&e.length&&(t!=null&&t.configuration)){const o={};return e.forEach(c=>{var g;o[c.field]=((g=t.configuration.visible_columns)==null?void 0:g.includes(c.field))||!1}),o}else if(e!=null&&e.length)return V(e);return{}}),[i,s]=p.useState(()=>{var o;return(o=t==null?void 0:t.configuration)!=null&&o.column_order?t.configuration.column_order:e!=null&&e.length?J(e):[]}),a=p.useMemo(()=>({visibility:r,order:i}),[r,i]),d=p.useMemo(()=>({visible:Object.entries(r).filter(([c,g])=>g).map(([c])=>c),order:i}),[r,i]),l=p.useCallback(o=>{n(o)},[]),x=p.useCallback((o,c)=>{if(o!=null&&o.configuration){const g={};c.forEach(j=>{var S;g[j.field]=((S=o.configuration.visible_columns)==null?void 0:S.includes(j.field))||!1}),n(g),s(o.configuration.column_order||[])}else n(V(c)),s(J(c))},[]),_=p.useCallback(o=>{Object.keys(r).length===0&&n(V(o)),i.length===0&&s(J(o))},[]),C=p.useRef();return p.useEffect(()=>{var o,c,g;if(e!=null&&e.length){const j=((o=C.current)==null?void 0:o.id)!==(t==null?void 0:t.id),S=t&&((c=C.current)==null?void 0:c.id)===t.id&&C.current.updated_at!==t.updated_at;if(j||S)if(t!=null&&t.configuration){const h={};e.forEach(T=>{var O,w;h[T.field]=((w=(O=t.configuration)==null?void 0:O.visible_columns)==null?void 0:w.includes(T.field))||!1}),n(h),s(((g=t.configuration)==null?void 0:g.column_order)||[])}else n(V(e)),s(J(e))}C.current=t},[t,e]),{visibleColumns:r,columnOrder:i,columnState:a,currentColumns:d,setVisibleColumns:n,setColumnOrder:s,handleColumnVisibilityChange:l,handleViewChange:x,initializeColumns:_}}var Q=500;function V(e){if(!e||e.length===0)return{};const t={};return e.forEach(r=>{t[r.field]=r.default_visible??!0}),t}function J(e){return!e||e.length===0?[]:[...e].sort((r,n)=>{const i=r.default_order??Q,s=n.default_order??Q;return i-s}).map(r=>r.field)}var X={orders:{properties:["id","status","created_at","email","display_id","payment_status","fulfillment_status","total","currency_code"],relations:["*customer","*sales_channel"]},products:{properties:["id","title","handle","status","thumbnail"],relations:["collection.title","*sales_channels","*variants"]},customers:{properties:["id","email","first_name","last_name","created_at","updated_at","has_account"],relations:["*groups"]},inventory:{properties:["id","sku","title","description","stocked_quantity","reserved_quantity","created_at","updated_at"],relations:["*location_levels"]},default:{properties:["id","created_at","updated_at"],relations:[]}};function Ie(e){const t=X[e]||X.default;return{properties:t.properties,relations:t.relations,formatted:[...t.properties,...t.relations].join(",")}}function ze(e,t,r){const n=Ie(e),i=n.formatted;if(!(t!=null&&t.length))return i;const s=t.filter(c=>Object.keys(r).length>0?r[c.field]===!0:c.default_visible),a=new Set;s.forEach(c=>{var g,j;c.computed?((g=c.computed.required_fields)==null||g.forEach(S=>a.add(S)),(j=c.computed.optional_fields)==null||j.forEach(S=>a.add(S))):(c.field.includes("."),a.add(c.field))});const d=Array.from(a),l=d.filter(c=>c.includes(".")),x=d.filter(c=>!c.includes(".")),_=l.filter(c=>{const[g]=c.split(".");return!n.relations.some(S=>S===`*${g}`||S===g)}),C=x.filter(c=>!n.properties.includes(c)),o=[..._,...C];return o.length>0?`${i},${o.join(",")}`:i}function Me(e){return e.startsWith("-")?{id:e.slice(1),desc:!0}:{id:e,desc:!1}}function Ve({entity:e,queryPrefix:t="",filters:r=[]}){const n=Ae("view_configurations"),[i,s]=De(),{activeView:a,createView:d}=Se(e),l=(a==null?void 0:a.view_configuration)||null,{updateView:x}=ve(e,(l==null?void 0:l.id)||""),{columns:_,isLoading:C}=Oe(e,{enabled:n}),o=xe(["q","order","offset","limit",...r.map(m=>m.id)],t),{visibleColumns:c,columnOrder:g,currentColumns:j,setColumnOrder:S,handleColumnVisibilityChange:h,handleViewChange:T}=$e(_,l);p.useEffect(()=>{_&&(T(l,_),s(m=>{if(Array.from(m.keys()).filter(f=>f.startsWith(t+"_")||f===t+"_q"||f===t+"_order").forEach(f=>m.delete(f)),l){const f=l.configuration;if(f.filters&&Object.entries(f.filters).forEach(([D,v])=>{m.set(`${t}_${D}`,JSON.stringify(v))}),f.sorting){const D=f.sorting.desc?`-${f.sorting.id}`:f.sorting.id;m.set(`${t}_order`,D)}f.search&&m.set(`${t}_q`,f.search)}return m}))},[l,_]);const O=p.useMemo(()=>{const m={};return r.forEach(y=>{o[y.id]!==void 0&&(m[y.id]=JSON.parse(o[y.id]||""))}),{filters:m,sorting:o.order?Me(o.order):null,search:o.q||""}},[r,o]),[w,L]=p.useState(!1),z=p.useMemo(()=>{const m=O.filters,y=O.sorting,f=O.search,D=Object.entries(c).filter(([v,E])=>E).map(([v])=>v).sort();if(l){const v=l.configuration.filters||{},E=l.configuration.sorting,$=l.configuration.search||"",A=[...l.configuration.visible_columns||[]].sort(),R=l.configuration.column_order||[],q=new Set([...Object.keys(m),...Object.keys(v)]);for(const M of q)if(JSON.stringify(m[M])!==JSON.stringify(v[M]))return!0;const F=y||void 0,P=E||void 0;if(JSON.stringify(F)!==JSON.stringify(P)||f!==$||JSON.stringify(D)!==JSON.stringify(A)||JSON.stringify(g)!==JSON.stringify(R))return!0}else{if(Object.keys(m).length>0||y!==null||f!=="")return!0;if(_){const v=new Set(D),E=new Set(_.filter(A=>A.default_visible).map(A=>A.field));if(v.size!==E.size||[...v].some(A=>!E.has(A)))return!0;const $=_.sort((A,R)=>(A.default_order??500)-(R.default_order??500)).map(A=>A.field);if(JSON.stringify(g)!==JSON.stringify($))return!0}}return!1},[l,c,g,O,_]);p.useEffect(()=>{const m=setTimeout(()=>{L(z)},50);return()=>clearTimeout(m)},[z]);const N=p.useCallback(()=>{_&&T(l,_),s(m=>{if(Array.from(m.keys()).filter(f=>f.startsWith(t+"_")||f===t+"_q"||f===t+"_order").forEach(f=>m.delete(f)),l!=null&&l.configuration){const f=l.configuration;if(f.filters&&Object.entries(f.filters).forEach(([D,v])=>{m.set(`${t}_${D}`,JSON.stringify(v))}),f.sorting){const D=f.sorting.desc?`-${f.sorting.id}`:f.sorting.id;m.set(`${t}_order`,D)}f.search&&m.set(`${t}_q`,f.search)}return m})},[l,_,t]),U=p.useMemo(()=>ze(e,_,c),[e,_,c]);return{activeView:l,createView:d,updateView:x,isViewConfigEnabled:n,visibleColumns:c,columnOrder:g,currentColumns:j,setColumnOrder:S,handleColumnVisibilityChange:h,currentConfiguration:O,hasConfigurationChanged:w,handleClearConfiguration:N,apiColumns:_,isLoadingColumns:C,queryParams:o,requiredFields:U}}var b=new Map,Je=(e,t)=>t.split(".").reduce((r,n)=>r==null?void 0:r[n],e),W=(e,t,r,n)=>e==null?"-":String(e),Le=(e,t,r,n)=>{const i=e||[],s=Array.isArray(i)?i.length:0;return n("general.items",{count:s})},ee=(e,t,r,n)=>{if(!e)return"-";if(r.field==="status"&&t.status&&(t.handle||t.is_giftcard!==void 0))return u.jsx(me,{status:t.status});if(r.context==="payment"&&n){const{label:d,color:l}=de(n,e);return u.jsx(H,{color:l,children:d})}if(r.context==="fulfillment"&&n){const{label:d,color:l}=fe(n,e);return u.jsx(H,{color:l,children:d})}const i=d=>{switch(d==null?void 0:d.toLowerCase()){case"active":case"published":case"fulfilled":case"paid":return"green";case"pending":case"proposed":case"processing":return"orange";case"draft":return"grey";case"rejected":case"failed":case"canceled":return"red";default:return"grey"}},a=(d=>{if(!n)return d;const l=d.toLowerCase();switch(l){case"active":return n("general.active","Active");case"published":return n("products.productStatus.published","Published");case"draft":return n("orders.status.draft","Draft");case"pending":return n("orders.status.pending","Pending");case"canceled":return n("orders.status.canceled","Canceled");default:return n(`status.${l}`,d)}})(e);return u.jsx(H,{color:i(e),children:a})},te=(e,t,r,n)=>{if(r.field==="sales_channels_display"||r.field==="sales_channels")return u.jsx(_e,{salesChannels:t.sales_channels});if(!Array.isArray(e))return"-";const i=e.slice(0,2),s=e.length-2;return u.jsxs("div",{className:"flex gap-1",children:[i.map((a,d)=>u.jsx(K,{size:"xsmall",children:typeof a=="string"?a:a.name||a.title||"-"},d)),s>0&&u.jsx(K,{size:"xsmall",color:"grey",children:n?n("general.plusCountMore","+ {{count}} more",{count:s}):`+${s}`})]})},Ue=(e,t,r,n)=>u.jsx(pe,{product:t}),qe=(e,t,r,n)=>u.jsx(he,{collection:t.collection}),Pe=(e,t,r,n)=>u.jsx(ye,{variants:t.variants}),Be=(e,t,r,n)=>{var i,s,a,d;if((i=t.customer)!=null&&i.first_name||(s=t.customer)!=null&&s.last_name){const l=`${t.customer.first_name||""} ${t.customer.last_name||""}`.trim();if(l)return l}return(a=t.customer)!=null&&a.email?t.customer.email:(d=t.customer)!=null&&d.phone?t.customer.phone:n?n("customers.guest","Guest"):"Guest"},He=(e,t,r,n)=>{let i=null;if(r.field==="shipping_address_display"?i=t.shipping_address:r.field==="billing_address_display"?i=t.billing_address:i=t.shipping_address||t.billing_address,!i)return"-";const s=[];i.address_1&&s.push(i.address_1);const a=[];return i.city&&a.push(i.city),i.province&&a.push(i.province),i.postal_code&&a.push(i.postal_code),a.length>0&&s.push(a.join(", ")),i.country_code&&s.push(i.country_code.toUpperCase()),s.join(" â€¢ ")||"-"},We=(e,t,r,n)=>{var d;const i=(d=t.shipping_address)==null?void 0:d.country_code;if(!i)return u.jsx("div",{className:"flex w-full justify-center",children:"-"});const s=Te(i),a=(s==null?void 0:s.display_name)||i.toUpperCase();return u.jsx("div",{className:"flex w-full items-center justify-center",children:u.jsx(we,{content:a,children:u.jsx("div",{className:"flex size-4 items-center justify-center overflow-hidden rounded-sm",children:u.jsx(Fe,{countryCode:i.toUpperCase(),svg:!0,style:{width:"16px",height:"16px"},"aria-label":a})})})})},G=(e,t,r,n)=>u.jsx(ue,{date:e}),Ye=(e,t,r,n)=>u.jsx(ce,{displayId:e}),re=(e,t,r,n)=>{const i=t.currency_code||"USD";return u.jsx(ge,{currencyCode:i,amount:e,align:"right"})},Ge=(e,t,r,n)=>{const i=t.currency_code||"USD";return u.jsx(le,{currencyCode:i,total:e})};b.set("text",W);b.set("count",Le);b.set("status",ee);b.set("badge_list",te);b.set("date",G);b.set("timestamp",G);b.set("currency",re);b.set("total",Ge);b.set("product_info",Ue);b.set("collection",qe);b.set("variants",Pe);b.set("sales_channels_list",te);b.set("customer_name",Be);b.set("address_summary",He);b.set("country_code",We);b.set("display_id",Ye);function Ke(e,t){if(e&&b.has(e))return b.get(e);switch(t){case"number":case"string":return W;case"date":return G;case"boolean":return(r,n,i,s)=>s?r?s("fields.yes","Yes"):s("fields.no","No"):r?"Yes":"No";case"enum":return ee;case"currency":return re;default:return W}}function Qe(e,t){return t.computed?e:Je(e,t.field)}function Xe(e,t,r){const n=Re(),{t:i}=Y();return p.useMemo(()=>t!=null&&t.length?t.map(s=>{var _;let a=(_=s.computed)==null?void 0:_.type;a||(s.semantic_type==="timestamp"?a="timestamp":s.field==="display_id"?a="display_id":s.field==="total"?a="total":s.semantic_type==="currency"&&(a="currency"));const d=Ke(a,s.data_type),l=r!=null&&r.getColumnAlignment?r.getColumnAlignment(s):Ze(s),x=C=>Qe(C,s);return n.accessor(x,{id:s.field,header:()=>s.name,cell:({getValue:C,row:o})=>{const c=C();if(r!=null&&r.transformCellValue){const g=r.transformCellValue(c,o.original,s);if(g!==null)return g}return d(c,o.original,s,i)},meta:{name:s.name,column:s},enableHiding:s.hideable,enableSorting:s.sortable,headerAlign:l})}):[],[e,t,r,i])}function Ze(e){var t;return e.semantic_type==="currency"||e.data_type==="currency"||e.data_type==="number"&&e.context!=="identifier"||e.field.includes("total")||e.field.includes("amount")||e.field.includes("price")||e.field.includes("quantity")||e.field.includes("count")?"right":e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="country_code"||e.field==="country"||e.field.includes("country_code")?"center":"left"}var et={getColumnAlignment:e=>{var t;return e.semantic_type==="currency"?"right":e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="country_code"?"center":"left"}},tt={getColumnAlignment:e=>{var t,r,n;return e.field==="product_display"||e.field==="collection.title"||e.field==="sales_channels_display"||e.field==="variants_count"?"left":e.field==="sku"?"center":e.field==="stock"||e.semantic_type==="currency"?"right":(e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="product_info"||((r=e.computed)==null?void 0:r.type)==="count"||((n=e.computed)==null?void 0:n.type)==="sales_channels_list","left")},transformCellValue:(e,t,r)=>{var n,i,s;if(r.field==="variants_count"||((n=r.computed)==null?void 0:n.type)==="count"){const a=Array.isArray(t.variants)?t.variants.length:0;return`${a} ${a===1?"variant":"variants"}`}return r.field==="product_display"||((i=r.computed)==null?void 0:i.type)==="product_info"||r.field==="sales_channels_display"||((s=r.computed)==null?void 0:s.type)==="sales_channels_list"||r.field==="status",null}},rt={getColumnAlignment:e=>e.field==="orders_count"||e.semantic_type==="currency"?"right":e.semantic_type==="status"?"center":"left",transformCellValue:(e,t,r)=>{if(r.field==="name"){const{first_name:n,last_name:i}=t;return n||i?`${n||""} ${i||""}`.trim():"-"}return null}},nt={getColumnAlignment:e=>e.field==="stocked_quantity"||e.field==="reserved_quantity"||e.field==="available_quantity"?"right":e.semantic_type==="status"?"center":"left"},st={orders:et,products:tt,customers:rt,inventory:nt};function it(e){return st[e]}function ht({adapter:e,heading:t,subHeading:r,pageSize:n,queryPrefix:i,layout:s="fill",actions:a}){const{t:d}=Y(),[l,x]=p.useState(!1),[_,C]=p.useState(null),o=e.entity,c=e.entityName,g=e.filters||[],j=n||e.pageSize||20,S=i||e.queryPrefix||"",{activeView:h,createView:T,updateView:O,isViewConfigEnabled:w,visibleColumns:L,columnOrder:z,currentColumns:N,setColumnOrder:U,handleColumnVisibilityChange:m,currentConfiguration:y,hasConfigurationChanged:f,handleClearConfiguration:D,isLoadingColumns:v,apiColumns:E,requiredFields:$,queryParams:A}=Ve({entity:o,queryPrefix:S,filters:g}),R={...A};g.forEach(I=>{const B=I.id;if(R[B]!==void 0)try{R[B]=JSON.parse(R[B])}catch{}});const q={...R,fields:$,limit:j,offset:R.offset?Number(R.offset):0},F=e.useData($,q),P=e.columnAdapter||it(o),M=Xe(o,E||[],P),ne=e.getColumns&&E?e.getColumns(E):M;if(F.isError)throw F.error;const se=async()=>{try{h!=null&&h.is_system_default?await O.mutateAsync({name:h.name||null,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}}):await T.mutateAsync({name:"Default",is_system_default:!0,set_active:!0,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}})}catch{}},ie=async()=>{if(h)try{await O.mutateAsync({name:h.name,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}})}catch{}},ae=()=>{x(!0),C(null)},oe=f?u.jsxs(u.Fragment,{children:[u.jsx(Z,{variant:"secondary",size:"small",type:"button",onClick:D,children:d("actions.clear")}),u.jsx(ke,{isDefaultView:(h==null?void 0:h.is_system_default)||!h,currentViewId:h==null?void 0:h.id,currentViewName:h==null?void 0:h.name,onSaveAsDefault:se,onUpdateExisting:ie,onSaveAsNew:ae})]}):null;return u.jsxs(je,{className:"divide-y p-0",children:[u.jsx(be,{data:F.data||[],columns:ne,filters:g,getRowId:e.getRowId||(I=>I.id),rowCount:F.count,enablePagination:!0,enableSearch:!0,pageSize:j,isLoading:F.isLoading||v,layout:s,heading:t||c||(o?d(`${o}.domain`):""),subHeading:r,enableColumnVisibility:w,initialColumnVisibility:L,onColumnVisibilityChange:m,columnOrder:z,onColumnOrderChange:U,enableViewSelector:w,entity:o,currentColumns:N,filterBarContent:oe,rowHref:e.getRowHref,emptyState:e.emptyState||{empty:{heading:d(`${o}.list.noRecordsMessage`)}},prefix:S,actions:a,enableFilterMenu:!1}),l&&u.jsx(Ce,{entity:o,currentColumns:N,currentConfiguration:y,editingView:_,onClose:()=>{x(!1),C(null)},onSaved:()=>{x(!1),C(null)}})]})}function yt(e){return{getRowId:t=>t.id,pageSize:20,queryPrefix:"",...e}}export{ht as C,yt as c,et as o,tt as p};
