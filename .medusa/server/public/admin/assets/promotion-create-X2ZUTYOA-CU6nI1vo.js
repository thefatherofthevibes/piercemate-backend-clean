import{D as pe,C as be}from"./chunk-BZKI5J2M-CXsF1mDR.js";import{j as e,r as D,b as ve,z as Ce,aC as Ne,aD as Fe,d$ as we,t as P,F as j,e0 as De,J as a,H as Se,an as Re,a0 as u,K as k,a3 as q,I as f,aF as Ie,dN as Ve,B as H,ax as G,aA as b,aK as B,az as m,ay as $,aI as me,aJ as qe}from"./index-CU6eNUFN.js";import{D as Be}from"./chunk-KEQOAJC2-CNQ0HFSI.js";import{A as Te}from"./chunk-YIOBBZUB-BMSUME0u.js";import"./chunk-OFN7DIZA-AqDsxLMm.js";import{c as Ee,g as Ae}from"./chunk-DK4WIVY6-CYCbBMOO.js";import{R as O}from"./chunk-OXPE5TAY-BOu9Hvpe.js";import{K as Le}from"./chunk-6HTZNHPT-CQK7Nsir.js";import"./chunk-WVA4O7QS-ClTyIHdU.js";import{R as v,u as Me}from"./chunk-D6UW7URG-Dnreh06z.js";import{T as K}from"./Trans-TuWeNclR.js";import{P as g}from"./progress-tabs-tcfMUrUN.js";import{R as c}from"./radio-group-DJBI5ron.js";import{A as ze}from"./alert-BeAS6yhq.js";import"./chunk-F6ZOHZVB-fviPx_bo.js";import"./chunk-5LGRZSEH-DYZx3sHR.js";import"./textarea-zAje8BFr.js";import"./chunk-3TZOFKX2-CT89dJ05.js";import"./index-DA61-62J.js";var U=me(G({id:m().optional(),attribute:m().min(1,{message:"Required field"}),operator:m().min(1,{message:"Required field"}),values:qe([B().min(1,{message:"Required field"}),m().min(1,{message:"Required field"}),me(m()).min(1,{message:"Required field"})]),required:$().optional(),disguised:$().optional(),field_type:m().optional()})),Pe=G({template_id:m().optional(),campaign_id:m().optional(),campaign_choice:b(["none","existing","new"]).optional(),is_automatic:m().toLowerCase(),code:m().min(1),type:b(["buyget","standard"]),status:b(["draft","active","inactive"]),rules:U,is_tax_inclusive:$().optional(),limit:B().int().min(1).nullable().optional(),application_method:G({allocation:b(["each","across","once"]),value:B().min(0).or(m().min(1)),currency_code:m().optional(),max_quantity:B().optional().nullable(),target_rules:U,buy_rules:U,type:b(["fixed","percentage"]),target_type:b(["order","shipping_methods","items"])}),campaign:be.optional()}).refine(x=>x.application_method.allocation==="across"?!0:(x.application_method.allocation==="each"||x.application_method.allocation==="once")&&typeof x.application_method.max_quantity=="number",{path:["application_method.max_quantity"],message:"required field"}),C=["type","application_method.type"],ke=[...C,"application_method.allocation"],He=[...C,"application_method.allocation.across"],Oe=[...C,"application_method.allocation","is_tax_inclusive"],Ke=[...C,"application_method.allocation.across","is_tax_inclusive"],Ue=[...C,"application_method.value","application_method.allocation","is_tax_inclusive"],Ge=[...C,"application_method.value","application_method.allocation","is_tax_inclusive"],J=[{id:"amount_off_products",type:"standard",title:"Amount off products",description:"Discount specific products or collection of products",hiddenFields:He,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"each",target_type:"items",type:"fixed"}}},{id:"amount_off_order",type:"standard",title:"Amount off order",description:"Discounts the total order amount",hiddenFields:ke,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"order",type:"fixed"}}},{id:"percentage_off_product",type:"standard",title:"Percentage off product",description:"Discounts a percentage off selected products",hiddenFields:Ke,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"each",target_type:"items",type:"percentage"}}},{id:"percentage_off_order",type:"standard",title:"Percentage off order",description:"Discounts a percentage of the total order amount",hiddenFields:Oe,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"order",type:"percentage"}}},{id:"buy_get",type:"buy_get",title:"Buy X Get Y",description:"Buy X product(s), get Y product(s)",hiddenFields:Ue,defaults:{is_automatic:"false",type:"buyget",application_method:{type:"percentage",value:100,apply_to_quantity:1,max_quantity:1}}},{id:"shipping_discount",type:"standard",title:"Free shipping",description:"Applies a 100% discount to shipping fees",hiddenFields:Ge,defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"shipping_methods",type:"percentage",value:100}}}],ue={campaign_id:void 0,template_id:J[0].id,campaign_choice:"none",is_automatic:"false",code:"",type:"standard",status:"draft",rules:[],is_tax_inclusive:!1,limit:void 0,application_method:{allocation:"each",type:"fixed",target_type:"items",max_quantity:1,target_rules:[],buy_rules:[]},campaign:void 0},$e=()=>{var ae,oe,ie,se,ne;const[x,S]=D.useState("type"),[T,R]=D.useState({type:"in-progress",promotion:"not-started",campaign:"not-started"}),{t:o}=ve(),{handleSuccess:he}=Me(),y=Ce(),i=Ne({defaultValues:ue,resolver:Fe(Pe)}),{setValue:h,reset:X,getValues:Y}=i,{mutateAsync:xe}=we(),fe=i.handleSubmit(async t=>{const{campaign_choice:n,is_automatic:l,is_tax_inclusive:r,template_id:p,application_method:_,rules:N,...F}=t,{target_rules:le=[],buy_rules:re=[],...ce}=_,je=[...le.filter(d=>!!d.disguised),...re.filter(d=>!!d.disguised),...N.filter(d=>!!d.disguised)],de={};for(const d of je)de[d.attribute]=d.field_type==="number"?parseInt(d.values):d.values;const z=d=>d.filter(w=>!w.disguised).map(w=>({operator:w.operator,attribute:w.attribute,values:w.values}));t.campaign&&(t.campaign.budget.attribute=t.campaign.budget.attribute||null,t.campaign.budget.type=t.campaign.budget.attribute?"use_by_attribute":t.campaign.budget.type),xe({...F,rules:z(N),application_method:{...ce,...de,value:parseFloat(ce.value),target_rules:z(le),buy_rules:z(re)},is_tax_inclusive:r,is_automatic:l==="true"},{onSuccess:({promotion:d})=>{P.success(o("promotions.toasts.promotionCreateSuccess",{code:d.code})),he(`/promotions/${d.id}`)},onError:d=>{P.error(d.message)}})},async t=>{const{campaign:n,...l}=t||{};!!Object.keys(l||{}).length&&P.error(o("promotions.errors.promotionTabError"))}),E=async t=>{switch(t){case"type":R(n=>({...n,type:"in-progress"})),S(t);break;case"promotion":R(n=>({...n,type:"completed",promotion:"in-progress"})),S(t);break;case"campaign":{if(!await i.trigger()){R({type:"completed",promotion:"in-progress",campaign:"not-started"}),S("promotion");break}R(l=>({...l,promotion:"completed",campaign:"in-progress"})),S(t);break}}},ge=async()=>{switch(x){case"type":E("promotion");break;case"promotion":{await i.trigger()&&E("campaign");break}}},A=j({control:i.control,name:"template_id"}),s=D.useMemo(()=>{var n,l;const t=J.find(r=>r.id===A);if(t){X({...ue,template_id:A});for(const[r,p]of Object.entries(t.defaults))if(typeof p=="object")for(const[_,N]of Object.entries(p))h(`application_method.${_}`,N);else h(r,p);return((l=(n=t.defaults)==null?void 0:n.application_method)==null?void 0:l.allocation)==="across"&&h("application_method.max_quantity",null),t}},[A,h,X]),L=j({control:i.control,name:"application_method.type"})==="fixed",I=j({control:i.control,name:"application_method.allocation"});D.useEffect(()=>{I==="across"&&h("application_method.max_quantity",null)},[I,h]);const Q=j({control:i.control,name:"type"}),M=Q==="standard",W=Q==="buyget",ye=j({control:i.control,name:"application_method.target_type"})==="order",Z=i.getValues();let ee={};Z.application_method.currency_code&&(ee={budget:{currency_code:Z.application_method.currency_code}});const{campaigns:_e}=De(ee),V=j({control:i.control,name:"campaign_choice"});D.useEffect(()=>{var n,l;const t=Y();V!=="existing"&&h("campaign_id",void 0),V!=="new"&&h("campaign",void 0),V==="new"&&(!t.campaign||!((l=(n=t.campaign)==null?void 0:n.budget)!=null&&l.type))&&h("campaign",{...pe,budget:{...pe.budget,currency_code:t.application_method.currency_code}})},[V,Y,h]);const te=j({control:i.control,name:"rules"}).find(t=>t.attribute==="currency_code");if(te){const n=i.getValues().application_method.currency_code,l=te.values;!Array.isArray(l)&&n!==l&&i.setValue("application_method.currency_code",l)}return e.jsx(v.Form,{form:i,children:e.jsxs(Le,{className:"flex h-full flex-col",onSubmit:fe,children:[e.jsxs(g,{dir:y,value:x,onValueChange:t=>E(t),className:"flex h-full flex-col overflow-hidden",children:[e.jsx(v.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-x-4",children:e.jsx("div",{className:"-my-2 w-full max-w-[600px] border-l",children:e.jsxs(g.List,{className:"grid w-full grid-cols-3",children:[e.jsx(g.Trigger,{className:"w-full",value:"type",status:T.type,children:o("promotions.tabs.template")}),e.jsx(g.Trigger,{className:"w-full",value:"promotion",status:T.promotion,children:o("promotions.tabs.details")}),e.jsx(g.Trigger,{className:"w-full",value:"campaign",status:T.campaign,children:o("promotions.tabs.campaign")})]})})})}),e.jsxs(v.Body,{className:"size-full overflow-hidden",children:[e.jsx(g.Content,{value:"type",className:"size-full overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center",children:e.jsx("div",{className:"w-full max-w-[720px] py-16",children:e.jsx(a.Field,{control:i.control,name:"template_id",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.fields.type")}),e.jsx(a.Control,{children:e.jsx(c,{dir:y,className:"flex-col gap-y-3",...t,onValueChange:t.onChange,children:J.map(n=>e.jsx(c.ChoiceBox,{value:n.id,label:n.title,description:n.description},n.id))},"template_id")}),e.jsx(a.ErrorMessage,{})]})})})})}),e.jsx(g.Content,{value:"promotion",className:"size-full overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 py-16",children:[e.jsxs(Se,{level:"h1",className:"text-fg-base",children:[o("promotions.sections.details"),(s==null?void 0:s.title)&&e.jsx(Re,{className:"ml-2 align-middle",color:"grey",size:"2xsmall",rounded:"full",children:s==null?void 0:s.title})]}),i.formState.errors.root&&e.jsx(ze,{variant:"error",dismissible:!1,className:"text-balance",children:i.formState.errors.root.message}),e.jsx(a.Field,{control:i.control,name:"is_automatic",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.form.method.label")}),e.jsx(a.Control,{children:e.jsxs(c,{dir:y,className:"flex gap-y-3",...t,value:t.value,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"false",label:o("promotions.form.method.code.title"),description:o("promotions.form.method.code.description"),className:u("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"true",label:o("promotions.form.method.automatic.title"),description:o("promotions.form.method.automatic.description"),className:u("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:i.control,name:"status",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.form.status.label")}),e.jsx(a.Control,{children:e.jsxs(c,{dir:y,className:"flex gap-y-3",...t,value:t.value,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"draft",label:o("promotions.form.status.draft.title"),description:o("promotions.form.status.draft.description"),className:u("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"active",label:o("promotions.form.status.active.title"),description:o("promotions.form.status.active.description"),className:u("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx("div",{className:"flex gap-y-4",children:e.jsx(a.Field,{control:i.control,name:"code",render:({field:t})=>e.jsxs(a.Item,{className:"basis-1/2",children:[e.jsx(a.Label,{children:o("promotions.form.code.title")}),e.jsx(a.Control,{children:e.jsx(k,{...t,placeholder:"SUMMER15"})}),e.jsx(q,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(K,{t:o,i18nKey:"promotions.form.code.description",components:[e.jsx("br",{},"break")]})})]})})}),!((ae=s==null?void 0:s.hiddenFields)!=null&&ae.includes("is_tax_inclusive"))&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsx("div",{className:"flex gap-x-2 gap-y-4",children:e.jsx(a.Field,{control:i.control,name:"is_tax_inclusive",render:({field:{onChange:t,value:n,...l}})=>e.jsxs(a.Item,{className:"basis-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"block",children:[e.jsx(a.Label,{children:o("promotions.form.taxInclusive.title")}),e.jsx(a.Hint,{className:"!mt-1",children:o("promotions.form.taxInclusive.description")})]}),e.jsx(a.Control,{className:"mr-2 self-center",children:e.jsx(Ie,{dir:"ltr",className:"mt-[2px] rtl:rotate-180",checked:!!n,onCheckedChange:t,...l})})]}),e.jsx(a.ErrorMessage,{})]})})})]}),!((oe=s==null?void 0:s.hiddenFields)!=null&&oe.includes("type"))&&e.jsx(a.Field,{control:i.control,name:"type",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.fields.type")}),e.jsx(a.Control,{children:e.jsxs(c,{dir:y,className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"standard",label:o("promotions.form.type.standard.title"),description:o("promotions.form.type.standard.description"),className:u("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"buyget",label:o("promotions.form.type.buyget.title"),description:o("promotions.form.type.buyget.description"),className:u("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(f,{}),e.jsx(O,{form:i,ruleType:"rules"}),!((ie=s==null?void 0:s.hiddenFields)!=null&&ie.includes("application_method.type"))&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsx(a.Field,{control:i.control,name:"application_method.type",render:({field:t})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("promotions.fields.value_type")}),e.jsx(a.Control,{children:e.jsxs(c,{dir:y,className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(c.ChoiceBox,{value:"fixed",label:o("promotions.form.value_type.fixed.title"),description:o("promotions.form.value_type.fixed.description"),className:u("basis-1/2")}),e.jsx(c.ChoiceBox,{value:"percentage",label:o("promotions.form.value_type.percentage.title"),description:o("promotions.form.value_type.percentage.description"),className:u("basis-1/2")})]})}),e.jsx(a.ErrorMessage,{})]})})]}),!((se=s==null?void 0:s.hiddenFields)!=null&&se.includes("application_method.value"))&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsx(a.Field,{control:i.control,name:"application_method.value",render:({field:{onChange:t,value:n,...l}})=>{const r=i.getValues().application_method.currency_code,p=Ee[(r==null?void 0:r.toUpperCase())||"USD"];return e.jsxs(a.Item,{className:"basis-1/2",children:[e.jsx(a.Label,{tooltip:r||!L?void 0:o("promotions.fields.amount.tooltip"),children:o("promotions.form.value.title")}),e.jsx(a.Control,{children:L?e.jsx(Ve,{...l,min:0,code:r||"USD",onValueChange:(_,N,F)=>t(F==null?void 0:F.value),decimalScale:(p==null?void 0:p.decimal_digits)??2,decimalsLimit:(p==null?void 0:p.decimal_digits)??2,symbol:r?Ae(r):"$",value:n,disabled:!r}):e.jsx(Be,{className:"text-right",min:0,max:100,...l,value:n,onChange:_=>{t(_.target.value===""?null:parseFloat(_.target.value))}},"amount")}),e.jsx(q,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(K,{t:o,i18nKey:L?"promotions.form.value_type.fixed.description":"promotions.form.value_type.percentage.description",components:[e.jsx("br",{},"break")]})}),e.jsx(a.ErrorMessage,{})]})}})]}),(M&&(I==="each"||I==="once")||W)&&e.jsxs(e.Fragment,{children:[W&&e.jsx(e.Fragment,{children:e.jsx(f,{})}),e.jsx(a.Field,{control:i.control,name:"application_method.max_quantity",render:({field:t})=>e.jsxs(a.Item,{className:"basis-1/2",children:[e.jsx(a.Label,{children:o("promotions.form.max_quantity.title")}),e.jsx(a.Control,{children:e.jsx(k,{...i.register("application_method.max_quantity",{valueAsNumber:!0}),type:"number",min:1,placeholder:"3"})}),e.jsx(q,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(K,{t:o,i18nKey:"promotions.form.max_quantity.description",components:[e.jsx("br",{},"break")]})})]})})]}),M&&!((ne=s==null?void 0:s.hiddenFields)!=null&&ne.includes("application_method.allocation"))&&e.jsx(a.Field,{control:i.control,name:"application_method.allocation",render:({field:t})=>{var n,l,r;return e.jsxs(a.Item,{children:[e.jsx(a.Label,{tooltip:o("promotions.fields.allocationTooltip"),children:o("promotions.fields.allocation")}),e.jsx(a.Control,{children:e.jsxs(c,{dir:y,className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[!((n=s==null?void 0:s.hiddenFields)!=null&&n.includes("application_method.allocation.each"))&&e.jsx(c.ChoiceBox,{value:"each",label:o("promotions.form.allocation.each.title"),description:o("promotions.form.allocation.each.description"),className:u("basis-1/3")}),!((l=s==null?void 0:s.hiddenFields)!=null&&l.includes("application_method.allocation.across"))&&e.jsx(c.ChoiceBox,{value:"across",label:o("promotions.form.allocation.across.title"),description:o("promotions.form.allocation.across.description"),className:u("basis-1/3")}),!((r=s==null?void 0:s.hiddenFields)!=null&&r.includes("application_method.allocation.once"))&&e.jsx(c.ChoiceBox,{value:"once",label:o("promotions.form.allocation.once.title"),description:o("promotions.form.allocation.once.description"),className:u("basis-1/3")})]})}),e.jsx(a.ErrorMessage,{})]})}}),!M&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsx(O,{form:i,ruleType:"buy-rules",scope:"application_method.buy_rules"})]}),!ye&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsx(O,{form:i,ruleType:"target-rules",scope:"application_method.target_rules"})]}),e.jsx(f,{}),e.jsx(a.Field,{control:i.control,name:"limit",render:({field:{onChange:t,value:n,...l}})=>e.jsxs(a.Item,{className:"basis-1/2",children:[e.jsx(a.Label,{children:o("promotions.form.limit.title")}),e.jsx(a.Control,{children:e.jsx(k,{...l,type:"number",min:1,value:n??"",onChange:r=>{const p=r.target.value;t(p===""?null:parseInt(p,10))},placeholder:"100"})}),e.jsx(q,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:o("promotions.form.limit.description")}),e.jsx(a.ErrorMessage,{})]})})]})})}),e.jsx(g.Content,{value:"campaign",className:"size-full overflow-auto",children:e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 py-16",children:e.jsx(Te,{form:i,campaigns:_e||[]})})})})]})]}),e.jsx(v.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(v.Close,{asChild:!0,children:e.jsx(H,{variant:"secondary",size:"small",children:o("actions.cancel")})}),x==="campaign"?e.jsx(H,{type:"submit",size:"small",isLoading:!1,children:o("actions.save")},"save-btn"):e.jsx(H,{type:"button",onClick:ge,size:"small",children:o("actions.continue")},"continue-btn")]})})]})})},ft=()=>e.jsx(v,{children:e.jsx($e,{})});export{ft as Component};
