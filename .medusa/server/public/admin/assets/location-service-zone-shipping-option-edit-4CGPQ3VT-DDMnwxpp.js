import{a as F}from"./chunk-UC26CCHZ-DbXuoyCH.js";import{S as T}from"./chunk-PYIO3TDQ-D8Zv8hXV.js";import{f as I}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{u as b}from"./chunk-3TZOFKX2-CT89dJ05.js";import{C as j}from"./chunk-OFN7DIZA-AqDsxLMm.js";import{S as V}from"./chunk-PRLQLEEQ-C2DbjXYe.js";import{K as w}from"./chunk-6HTZNHPT-CQK7Nsir.js";import{R as m}from"./chunk-WVA4O7QS-ClTyIHdU.js";import{u as N}from"./chunk-D6UW7URG-Dnreh06z.js";import{b as L,ag as P,a_ as z,j as e,H as D,z as O,aC as R,aD as B,t as v,J as i,K as M,I as $,B as S,ax as q,az as u,ay as K,ex as H,s as C}from"./index-CU6eNUFN.js";import{u as A,c as G}from"./chunk-HBXV7ENS-DMUVco03.js";import{R as g}from"./radio-group-DJBI5ron.js";import"./index-DA61-62J.js";function J(p,n){const l={};return n.forEach(o=>{o in p&&(l[o]=p[o])}),l}var U=q({name:u().min(1),price_type:H(T),enabled_in_store:K().optional(),shipping_profile_id:u(),shipping_option_type_id:u(),provider_id:u().optional()}),Z=({locationId:p,shippingOption:n,type:l})=>{const{t:o}=L(),{handleSuccess:h}=N(),f=O(),x=l==="pickup",d=b({queryFn:s=>C.admin.shippingProfile.list(s),queryKey:["shipping_profiles"],getOptions:s=>s.shipping_profiles.map(t=>({label:t.name,value:t.id})),defaultValue:n.shipping_profile_id}),r=b({queryFn:s=>C.admin.shippingOptionType.list(s),queryKey:["shipping_option_types"],getOptions:s=>s.shipping_option_types.map(t=>({label:t.label,value:t.id}))}),a=R({defaultValues:{name:n.name,price_type:n.price_type,enabled_in_store:F(n),shipping_profile_id:n.shipping_profile_id,shipping_option_type_id:n.type.id,provider_id:n.provider_id},resolver:B(U)}),{mutateAsync:_,isPending:k}=G(n.id),E=a.handleSubmit(async s=>{const t=n.rules.map(c=>({...J(c,["id","attribute","operator","value"])})),y=t.find(c=>c.attribute==="enabled_in_store");y?y.value=s.enabled_in_store?"true":"false":t.push({value:s.enabled_in_store?"true":"false",attribute:"enabled_in_store",operator:"eq"}),await _({name:s.name,price_type:s.price_type,shipping_profile_id:s.shipping_profile_id,rules:t,type_id:s.shipping_option_type_id},{onSuccess:({shipping_option:c})=>{v.success(o("stockLocations.shippingOptions.edit.successToast",{name:c.name})),h(`/settings/locations/${p}`)},onError:c=>{v.error(c.message)}})});return e.jsx(m.Form,{form:a,children:e.jsxs(w,{onSubmit:E,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(m.Body,{className:"overflow-y-auto",children:e.jsx("div",{className:"flex flex-col gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-8",children:[!x&&e.jsx(i.Field,{control:a.control,name:"price_type",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:o("stockLocations.shippingOptions.fields.priceType.label")}),e.jsx(i.Control,{children:e.jsxs(g,{dir:f,...s,onValueChange:s.onChange,children:[e.jsx(g.ChoiceBox,{className:"flex-1",value:"flat",label:o("stockLocations.shippingOptions.fields.priceType.options.fixed.label"),description:o("stockLocations.shippingOptions.fields.priceType.options.fixed.hint")}),e.jsx(g.ChoiceBox,{className:"flex-1",value:"calculated",label:o("stockLocations.shippingOptions.fields.priceType.options.calculated.label"),description:o("stockLocations.shippingOptions.fields.priceType.options.calculated.hint")})]})}),e.jsx(i.ErrorMessage,{})]})}),e.jsxs("div",{className:"grid gap-y-4",children:[e.jsx(i.Field,{control:a.control,name:"name",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:o("fields.name")}),e.jsx(i.Control,{children:e.jsx(M,{...s})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:a.control,name:"shipping_profile_id",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:o("stockLocations.shippingOptions.fields.profile")}),e.jsx(i.Control,{children:e.jsx(j,{...s,options:d.options,searchValue:d.searchValue,onSearchValueChange:d.onSearchValueChange,disabled:d.disabled})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:a.control,name:"shipping_option_type_id",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:o("stockLocations.shippingOptions.fields.type")}),e.jsx(i.Control,{children:e.jsx(j,{...s,options:r.options,searchValue:r.searchValue,onSearchValueChange:r.onSearchValueChange,disabled:r.disabled})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:a.control,name:"provider_id",disabled:!0,render:({field:s})=>{var t;return e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:o("stockLocations.shippingOptions.fields.provider")}),e.jsx(i.Control,{children:e.jsx(j,{value:n.provider_id,disabled:!0,options:[{label:`${I(n.provider_id)} (${((t=n==null?void 0:n.data)==null?void 0:t.id)||"N/A"})`,value:n.provider_id}]})}),e.jsx(i.ErrorMessage,{})]})}})]}),e.jsx($,{}),e.jsx(V,{control:a.control,name:"enabled_in_store",label:o("stockLocations.shippingOptions.fields.enableInStore.label"),description:o("stockLocations.shippingOptions.fields.enableInStore.hint")})]})})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(S,{size:"small",variant:"secondary",children:o("actions.cancel")})}),e.jsx(S,{size:"small",type:"submit",isLoading:k,children:o("actions.save")})]})})]})})},ce=()=>{const{t:p}=L(),{location_id:n,so_id:l}=P(),{shipping_options:o,isPending:h,isFetching:f,isError:x,error:d}=A({id:l,fields:"+service_zone.fulfillment_set.type"}),r=o==null?void 0:o.find(_=>_.id===l);if(!h&&!f&&!r)throw z({message:`Shipping option with ID ${l} was not found`},404);if(x)throw d;const a=(r==null?void 0:r.service_zone.fulfillment_set.type)==="pickup";return e.jsxs(m,{children:[e.jsx(m.Header,{children:e.jsx(D,{children:p(`stockLocations.${a?"pickupOptions":"shippingOptions"}.edit.header`)})}),r&&e.jsx(Z,{shippingOption:r,locationId:n,type:r.service_zone.fulfillment_set.type})]})};export{ce as Component};
