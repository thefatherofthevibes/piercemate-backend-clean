import{a as S}from"./chunk-EHAU7SOS-BdFruKSz.js";import{P}from"./chunk-KEQOAJC2-CNQ0HFSI.js";import{S as L}from"./chunk-PRLQLEEQ-C2DbjXYe.js";import{K as E}from"./chunk-6HTZNHPT-CQK7Nsir.js";import"./chunk-WVA4O7QS-ClTyIHdU.js";import{R as m,u as $}from"./chunk-D6UW7URG-Dnreh06z.js";import{ag as M,gf as z,j as e,b as F,aC as B,aD as K,ge as H,t as _,H as C,a3 as T,J as a,K as R,ak as V,d5 as k,B as N,ax as w,ay as D,az as g,aK as J,r as y,aw as h}from"./index-CU6eNUFN.js";var I=y.forwardRef(({disabled:l,placeholder:o,defaultValue:n,country_code:r,valueAs:i="iso_2",onChange:u,...d},c)=>{const{t:j}=F(),p=y.useRef(null);y.useImperativeHandle(c,()=>p.current);const s=S(r);s||(l=!0);const f=Object.entries((s==null?void 0:s.options)??{}).map(([t,b])=>e.jsx(h.Item,{value:i==="iso_2"?t.toLowerCase():b,children:b},t)),x=s?j(`taxRegions.fields.sublevels.placeholders.${s.type}`):"";return e.jsx("div",{className:"relative",children:e.jsxs(h,{...d,value:d.value?i==="iso_2"?d.value.toLowerCase():d.value:void 0,defaultValue:n?i==="iso_2"?n.toLowerCase():n:void 0,onValueChange:u,disabled:l,children:[e.jsx(h.Trigger,{ref:p,className:"w-full",children:e.jsx(h.Value,{placeholder:o||x})}),e.jsx(h.Content,{children:f})]})})});I.displayName="ProvinceSelect";var q=w({province_code:g().min(1),name:g().optional(),code:g().min(1),rate:w({float:J().optional(),value:g().optional()}).optional(),is_combinable:D().optional()}),G=({parent:l})=>{const{t:o}=F(),{handleSuccess:n}=$(),r=B({defaultValues:{province_code:"",code:"",is_combinable:!1,name:"",rate:{value:""}},resolver:K(q)}),{mutateAsync:i,isPending:u}=H(),d=r.handleSubmit(async s=>{var x;const f=s.name&&((x=s.rate)!=null&&x.float)?{name:s.name,rate:s.rate.float,code:s.code,is_combinable:s.is_combinable}:void 0;await i({country_code:l.country_code,province_code:s.province_code,parent_id:l.id,default_tax_rate:f},{onSuccess:({tax_region:t})=>{_.success(o("taxRegions.create.successToast")),n(`/settings/tax-regions/${l.id}/provinces/${t.id}`)},onError:t=>{_.error(t.message)}})}),c=S(l.country_code),j=(c==null?void 0:c.type)||"sublevel",p=o(`taxRegions.fields.sublevels.labels.${j}`);return e.jsx(m.Form,{form:r,children:e.jsxs(E,{onSubmit:d,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(m.Header,{}),e.jsx(m.Body,{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16",children:[e.jsxs("div",{children:[e.jsx(C,{children:o(`taxRegions.${j}.create.header`)}),e.jsx(T,{size:"small",className:"text-ui-fg-subtle",children:o(`taxRegions.${j}.create.hint`)})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.jsx(a.Field,{control:r.control,name:"province_code",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{tooltip:!c&&o("taxRegions.fields.sublevels.tooltips.sublevel"),children:p}),e.jsx(a.Control,{children:c?e.jsx(I,{country_code:l.country_code,...s}):e.jsx(R,{...s,placeholder:"KR-26"})}),e.jsx(a.ErrorMessage,{})]})})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(C,{level:"h2",className:"!txt-compact-small-plus",children:o("taxRegions.fields.defaultTaxRate.label")}),e.jsxs(T,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:["(",o("fields.optional"),")"]}),e.jsx(V,{content:o("taxRegions.fields.defaultTaxRate.tooltip"),children:e.jsx(k,{className:"text-ui-fg-muted"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(a.Field,{control:r.control,name:"name",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("fields.name")}),e.jsx(a.Control,{children:e.jsx(R,{...s})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:r.control,name:"rate",render:({field:{value:s,onChange:f,...x}})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("taxRegions.fields.taxRate")}),e.jsx(a.Control,{children:e.jsx(P,{...x,value:s==null?void 0:s.value,decimalsLimit:4,onValueChange:(t,b,v)=>f({value:t,float:v==null?void 0:v.float})})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:r.control,name:"code",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("taxRegions.fields.taxCode")}),e.jsx(a.Control,{children:e.jsx(R,{...s})}),e.jsx(a.ErrorMessage,{})]})})]})]}),e.jsx(L,{control:r.control,name:"is_combinable",label:o("taxRegions.fields.isCombinable.label"),description:o("taxRegions.fields.isCombinable.hint")})]})})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(N,{size:"small",variant:"secondary",children:o("actions.cancel")})}),e.jsx(N,{size:"small",type:"submit",isLoading:u,children:o("actions.save")})]})})]})})},A=()=>{const{id:l}=M(),{tax_region:o,isPending:n,isError:r,error:i}=z(l),u=!n&&!!o;if(r)throw i;return e.jsx(m,{children:u&&e.jsx(G,{parent:o})})};export{A as Component,A as TaxProvinceCreate};
