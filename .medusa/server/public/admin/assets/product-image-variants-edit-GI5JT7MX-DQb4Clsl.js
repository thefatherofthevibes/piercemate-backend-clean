import{u as z,_ as A}from"./chunk-DTZXEQXZ-BaBmpiQu.js";import{b as T,ag as O,af as B,a_ as F,j as e,H,a$ as M,r as v,aC as q,aD as $,t as w,a2 as P,ao as J,B as N,ax as K,aI as L,az as Q,g as G,k as Z}from"./index-CU6eNUFN.js";import"./chunk-ZQJPHZKI-B-mOVF44.js";import{u as U}from"./chunk-C76H5USB-B0JL6HGS.js";import{K as W}from"./chunk-6HTZNHPT-CQK7Nsir.js";import{R as d}from"./chunk-WVA4O7QS-ClTyIHdU.js";import{u as X}from"./chunk-D6UW7URG-Dnreh06z.js";import"./chunk-HQKGZADC-f8IAzGhQ.js";import"./chunk-EMIHDNB7-OmhvQEok.js";import"./chunk-DFFLVEZ5-D6yYebw6.js";import"./index-DA61-62J.js";var Y=({prefix:u,pageSize:r=20})=>{const t=U(["offset","q","order","created_at","updated_at"],u),{offset:l,q:h,order:o,created_at:n,updated_at:m}=t;return{searchParams:{limit:r,offset:l?Number(l):0,order:o,created_at:n?JSON.parse(n):void 0,updated_at:m?JSON.parse(m):void 0,q:h},raw:t}},g=20,ee=K({variants:L(Q())}),p=G(),ae=({productId:u,image:r})=>{var y;const{t}=T(),{handleSuccess:l}=X(),{mutateAsync:h,isPending:o}=M(u,r.id),[n,m]=v.useState(()=>{var a;return((a=r.variants)==null?void 0:a.reduce((s,c)=>(s[c.id]=!0,s),{}))||{}});v.useEffect(()=>{var a;m(((a=r.variants)==null?void 0:a.reduce((s,c)=>(s[c.id]=!0,s),{}))||{})},[r.variants.length]);const f=q({defaultValues:{variants:((y=r.variants)==null?void 0:y.map(a=>a.id))||[]},resolver:$(ee)}),k=f.handleSubmit(async a=>{var S;const s=((S=r==null?void 0:r.variants)==null?void 0:S.map(i=>i.id))||[],c=Object.keys(n).filter(i=>n[i]),x=c.filter(i=>!s.includes(i)),E=s.filter(i=>!c.includes(i));await h({add:x,remove:E},{onSuccess:()=>{w.success(t("products.variantMedia.successToast")),l()},onError:i=>{w.error(i.message)}})}),j=v.useMemo(()=>[p.display({id:"select",header:({table:a})=>e.jsx(P,{checked:a.getIsSomePageRowsSelected()?"indeterminate":a.getIsAllPageRowsSelected(),onCheckedChange:s=>a.toggleAllPageRowsSelected(!!s)}),cell:({row:a})=>e.jsx(P,{checked:a.getIsSelected(),onCheckedChange:s=>a.toggleSelected(!!s),onClick:s=>{s.stopPropagation()}})}),p.accessor("title",{header:()=>t("fields.title"),cell:({getValue:a})=>{const s=a();return e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate",children:s||"-"})})}}),p.accessor("sku",{header:()=>t("fields.sku"),cell:({getValue:a})=>{const s=a();return e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate font-mono text-sm",children:s||"-"})})}}),p.accessor("thumbnail",{header:()=>t("fields.thumbnail"),cell:({getValue:a})=>{const s=a()===r.url;return e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate text-sm",children:t(s?"fields.true":"fields.false")})})}})],[t]),C=a=>{const s=typeof a=="function"?a(n):a;m(s);const c=Object.keys(s).filter(x=>s[x]);f.setValue("variants",c,{shouldDirty:!0,shouldTouch:!0})},{searchParams:V,raw:_}=Y({pageSize:g}),{variants:I,count:b,isPending:D}=J(u,{...V},{placeholderData:Z}),{table:R}=z({data:I||[],columns:j,count:b,enablePagination:!0,enableRowSelection:!0,pageSize:g,getRowId:a=>a.id,rowSelection:{state:n,updater:C}});return e.jsx(d.Form,{form:f,children:e.jsxs(W,{onSubmit:k,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(d.Body,{className:"flex flex-col gap-y-8 overflow-y-auto p-0",children:e.jsx("div",{className:"flex h-full flex-col",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(A,{layout:"fill",table:R,columns:j,count:b,isLoading:D,pageSize:g,queryObject:_,pagination:!0,search:!0})})})}),e.jsx(d.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(N,{size:"small",variant:"secondary",children:t("actions.cancel")})}),e.jsx(N,{size:"small",type:"submit",isLoading:o,disabled:o,children:t("actions.save")})]})})]})})},he=()=>{var n;const{t:u}=T(),{id:r,image_id:t}=O(),{product:l,isPending:h}=B(r,{fields:"images.id,images.url,images.variants.id,-type,-collection,-options,-tags,-variants,-sales_channels"},{enabled:!!r&&!!t}),o=(n=l==null?void 0:l.images)==null?void 0:n.find(m=>m.id===t);if(!r||!t||h)return null;if(!h&&!o)throw F({message:`An image with ID ${t} was not found`},404);return e.jsxs(d,{children:[e.jsx(d.Header,{children:e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("img",{src:o.url,className:"h-20"}),e.jsxs("div",{children:[e.jsx(d.Title,{asChild:!0,children:e.jsx(H,{children:u("products.variantMedia.manageVariants")})}),e.jsx(d.Description,{children:u("products.variantMedia.manageVariantsDescription")})]})]})}),e.jsx(ae,{productId:r,image:o})]})};export{he as Component};
